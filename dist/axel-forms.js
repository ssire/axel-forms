/* ***** BEGIN LICENSE BLOCK *****
 *
 * Copyright (C) 2012 S. Sire
 *
 * This file contains files from the AXEL-FORMS extension to the Adaptable XML Editing Library (AXEL)
 * Version 0.2
 *
 * AXEL-FORMS is licensed by Oppidoc SARL 
 *
 * Web site : http://www.oppidoc.fr, https://bitbucket.org/ssire/axel-forms
 * 
 * Contributors(s) : S. Sire
 * 
 * ***** END LICENSE BLOCK ***** */
 (function(g){var h=0,i=0;var a={};var d={};var b={};var j={defaults:{},configure:function(l,m){this.defaults[l]=m},logError:function(m,l){g.error(m,l)},register:function(n,m,o){var l={factory:m};if(o){g.extend(l,o)}a[n]=l},getEditor:function(l){return d[l]},getCommand:function(m,n){var l=m,o=n,q=b[n],p=q?q[m]:undefined;return p||{execute:function(){alert("Command "+l+" not found on "+o)}}}};function k(n,o){var m=$(n).attr("id")||("untitled"+(h++)),l=new a.transform.factory(m,n,o);xtiger.cross.log("debug","registering editor "+m);d[m]=l;return l}function e(p,o,q){var n=$(p).attr("data-target")||("untitled"+(i++)),r=$(p).attr("id"),m=a[o],l;if(m){if(m.check){if(g.command.getEditor(n)){if(p.disabled){p.disabled=false}l=new a[o].factory(n,p,q)}else{p.disabled=true;g.error("Missing or invalid data-target attribute in "+o+' command ("'+n+'")')}}else{l=new a[o].factory(n,p,q)}if(l&&r){if(!b[r]){b[r]={}}b[r][o]=l}}else{g.error('Attempt to create an unkown command "'+o+'"')}}function c(s,t,o){var n,v,m,l=t||s,q=o||t,u=[],r=[],p=[];m=t?"[data-template]":"* [data-template]";v=l;do{$(m,v).each(function(w,x){u.push(x)});v=t?v.nextSibling:undefined}while(v&&(v!==o)&&(q!=t));m="[data-command]";v=l;do{$(m,v).each(function(w,x){if($(x).attr("data-command")!=="transform"){r.push(x)}else{if(!$(x).attr("data-template")){u.push(x)}}});v=t?v.nextSibling:undefined}while(v&&(v!==o)&&(q!=t));if(j.defaults.bundlesPath){for(n=0;n<u.length;n++){p.push(k(u[n],s))}}else{if(u.length>0){g.error("Cannot start editing because AXEL bundles path is unspecified")}}for(n=0;n<r.length;n++){u=$(r[n]).attr("data-command").split(" ");for(v=0;v<u.length;v++){e(r[n],u[v],s)}}return p}g.command=j;g.command.install=c;g.resolveUrl=function f(l,o){var n=l,m;if(l&&(l.length>2)){if(l.charAt(0)==="~"&&l.charAt(1)==="/"){if((window.location.href.charAt(window.location.href.length-1))!=="/"){n=window.location.href.split("#")[0]+"/"+l.substr(2)}else{n=l.substr(2)}}else{if(l.charAt(0)==="^"&&l.charAt(1)==="/"){n=($(o).closest("*[data-axel-base]").attr("data-axel-base")||"/")+l.substr(2)}}if(n.indexOf("$^")!==-1){m=window.location.href.split("#")[0].match(/([^\/]+)\/?$/);if(m){n=n.replace("$^",m[1])}}}return n};jQuery(function(){var m=$("script[data-bundles-path]"),n=m.attr("data-bundles-path"),l=m.attr("data-when"),o;if(n){j.configure("bundlesPath",n);g.filter.applyTo({optional:["input","choice"],event:"input"})}if(navigator.browserLanguage){o=navigator.browserLanguage}else{o=navigator.language}if(o){o=o.substr(0,2);if(xtiger.defaults.locales[o]){g.setLocale(o);xtiger.cross.log("debug","set lang to "+o)}}if("deferred"!==l){c(document)}})}($axel));(function(h){var a={};var j={getDocument:function(){return this._doc},getParam:function(k){return this._param[k]||this._defaults[k]},getVariable:function(){return this._variable}};var c={_installError:function(k){this.errScope=k.attr("data-error-scope")||undefined;this.errSel="[data-"+this.getName()+'-error="'+this.getVariable()+'"]'},toggleError:function(n,l){var k,m,o=this.getDocument();if(!this.errScope){k=$("body "+this.errSel,o)}else{if(l){m=$(l,o).closest(this.errScope);k=$(this.errSel,m.get(0))}}if(k){if(n){k.hide()}else{k.show()}}return n}};function d(n,m,l){var k=new Function();k.prototype=(function(o){var p=o;return{getName:function(){return p}}}(n));h.extend(k.prototype,j);if(m&&m.error){h.extend(k.prototype,c)}k.prototype.onInstall=l.onInstall;h.extend(k.prototype,l.methods,false,true);return k}function g(q,o,t,s){var r,l,p="#"+o,m=s||".af-label",n=[],k=[];q.apply(function(B){var u=(B.getParam("required")==="true"),w=B.isValid,v=(B.getParam("required")!=="true")||B.isModified(),z=(!v)||(!B.isValid||B.isValid()),A=$(B.getHandle()),x=A.parents().children(m).first(),C,y;if(v&&u){A.removeClass("af-required");x.removeClass("af-required")}if(z&&w){A.removeClass("af-invalid");x.removeClass("af-invalid")}if((u||w)&&(!v||!z)){C=x.contents(":not(span)").text();y=C.lastIndexOf(":");if(y!=-1){C=C.substr(0,y)}C=$.trim(C);if(!v&&u){A.addClass("af-required");x.addClass("af-required");n.push(C)}else{if(w){A.addClass("af-invalid");x.addClass("af-invalid");k.push(C)}}}});l=$(p,t).html("");if(n.length>0){l.append("<p>"+xtiger.util.getLocaleString("errFormRequired",{fields:n.join(", ")})+"</p>")}if(k.length>0){l.append("<p>"+xtiger.util.getLocaleString("errFormInvalid",{fields:k.join(", ")})+"</p>")}r=(n.length===0)&&(k.length===0);if(!r){l.addClass("af-validation-failed")}else{l.removeClass("af-validation-failed")}return r}function b(l,k){if(l){if(typeof l.isValid==="function"){l.isValid.extend(k)}else{l.isValid=function(n){var o=[n];var m=function(){var q,p=true;for(var q=0;q<o.length;q++){p=p&&o[q](this)}return p};m.extend=function(p){o.push(p)};return m}(k)}}else{xtiger.cross.log("error","attempt to set a validator function on an undefined editor")}}function i(n,m,o,q){var p={},l=d(n,m,q);h.extend(p,o);a[n]={name:n,options:m,defaults:p,klass:l}}function e(t,u,q){var n,o,m,s,l={},p=true;var r=u.attr("data-variable");if(r){m=t.defaults;for(n in m){if(m.hasOwnProperty(n)){s=u.attr("data-"+n);if(s){l[n]=s}else{if(m[n]===h.binding.REQUIRED){xtiger.cross.log("error",'Missing attribute "data-'+n+'" to install "'+t.name+'" binding');p=false;break}}}}if(p){o=new t.klass();o._doc=q;o._variable=r;o._defaults=m;o._param=l;if(t.options&&t.options.error){o._installError(u)}o.onInstall(u);return o}}else{xtiger.cross.log("error",'Missing attribute "data-variable" to install "'+t.name+'" binding')}}function f(o,k,n){var p=k||o,l=n||k,m=k?"[data-binding]":"body [data-binding]";do{$(m,p).each(function(q,u){var r,s=$(u),t=s.attr("data-binding").split(" ");for(r=0;r<t.length;r++){if(a[t[r]]){e(a[t[r]],s,o)}else{xtiger.cross.log("error",'unregistered binding "'+t[r]+'"')}}});p=k?p.nextSibling:undefined}while(p&&(p!==n)&&(l!=k))}h.binding=h.binding||{};h.binding.list=function(){var k,l=[];for(k in a){l.push(k)}return l};h.binding.register=i;h.binding.install=f;h.binding.validate=g;h.binding.setValidation=b;h.binding.REQUIRED=1}($axel));(function(a){var b={getCommand:function(g){var f,h,c={xhr:g};if(g.responseXML){c.doc=g.responseXML}else{h=xtiger.cross.makeDOMParser();try{c.doc=h.parseFromString(g.responseText,"text/xml")}catch(d){}}return c},filterRedirection:function(d){var e=d.xhr&&d.xhr.getResponseHeader("Location"),c=true;if(e){window.location.href=e;c=false}return c},handleMessage:function(c){msg=c.doc?$("success > message",c.doc).text():xhr.responseText;if(msg){alert(msg)}},handleForward:function(e){var g,f,d,c;if(e.doc){d=$("success > forward",e.doc);g=d.attr("command");f=d.text()}if(g&&f){c={synthetic:true,command:e};a.command.getCommand(g,f).execute(c)}},checkJSON:function(d){var c="application/json";return(typeof d==="string")&&(d.slice(0,c.length)===c)},unmarshalMessage:function(d){var c=d.responseXML?$("success > message",d.responseXML).text():d.responseText;return c},unmarshalPayload:function(e){var f=e.responseText.indexOf("<payload>"),c,d=e.responseText;if(-1!==f){c=e.responseText.indexOf("</payload>");if(-1!==c){d=e.responseText.substr(f+9,c-f-9)}}return d},isResponseAnOppidumError:function(g){var d=g.getResponseHeader("Content-Type"),c=false;if(g.responseXML){c=$("error > message",g.responseXML).size()>0}else{if(a.oppidum.checkJSON(d)){try{c=JSON.parse(g.responseText).error!==undefined}catch(f){}}}return c},getOppidumErrorMsg:function(g){var d=g.getResponseHeader("Content-Type"),c;if(g.responseXML){c=$("error > message",g.responseXML).text()}else{if(a.oppidum.checkJSON(d)){try{c=JSON.parse(g.responseText).error.message["#text"]}catch(f){}}else{c=g.responseText}}return c||g.status},getExistErrorMsg:function(h){var g=h.responseText,d=h.status;var f="Error ! Result code : "+d;var e="";var c=g.match("<title>(.*)</title>","m");if(c){e="\n"+c[1]}c=g.match("<h2>(.*)</h2>","m");if(c){e=e+"\n"+c[1]}else{if($("div.message",h.responseXML).size()>0){e=e+"\n"+$("div.message",h.responseXML).get(0).textContent;if($("div.description",h.responseXML).size()>0){e=e+"\n"+$("div.description",h.responseXML).get(0).textContent}}}return f+e},parseError:function(i,c,f,d){var h,g;if(c==="timeout"){g=xtiger.util.getLocaleString("errServerTimeOut")}else{if(i.status===409){h=i.getResponseHeader("Location");if(h){window.location.href=h;g=xtiger.util.getLocaleString("msgRedirect")}else{g=a.oppidum.getOppidumErrorMsg(i)}}else{if(a.oppidum.isResponseAnOppidumError(i)){g=a.oppidum.getOppidumErrorMsg(i)}else{if(i.responseText.search("Error</title>")!==-1){g=a.oppidum.getExistErrorMsg(i)}else{if(f&&(typeof f==="string")){g=xtiger.util.getLocaleString("errException",{e:{message:f},status:i.status})}else{if(f){g=xtiger.util.getLocaleString("errException",{e:f,status:i.status})}else{if(d){g=xtiger.util.getLocaleString("errLoadDocumentStatus",{url:d,xhr:i})}else{if(i.responseText!==""){g=i.responseText}else{g=xtiger.util.getLocaleString("errLoadDocumentStatus",{xhr:i})}}}}}}}}return g}};xtiger.registry.registerFactory("protocol.upload",{getInstance:function(c){return{decode_success:function(d){return(-1!==d.responseText.indexOf("<payload"))?a.oppidum.unmarshalPayload(d):a.oppidum.unmarshalMessage(d)},decode_error:function(d){return a.oppidum.parseError(d,d.status)}}}});a.oppidum=b}($axel));(function(a){var b=(function(){function e(g){var f;if(g.indexOf("\\ ")===-1){return g.split(" ")}else{f=g.replace(/\\ /g,"&nbsp;");return xtiger.util.array_map(f.split(" "),function(h){return h.replace(/&nbsp;/g," ")})}}function c(n,r,k){var h,g,s,m=n.getHandle(),q=n.getDocument(),p=n.getParam("multiple")==="yes"?"checkbox":"radio",j=n.getParam("noedit")==="true"?'disabled="true" ':"",f=n.getUniqueKey(),l=n.getParam("appearance")==="full";for(h=0;h<r.length;h++){if(l){$(m).append("<li><label><input "+j+'type="'+p+'" value="'+r[h]+'" name ="'+f+'"/>'+k[h]+"</label></li>")}else{g=xtdom.createElement(q,"option");s=xtdom.createTextNode(q,k[h]);xtdom.setAttribute(g,"value",r[h]);if(n.getParam("noedit")==="true"){xtdom.setAttribute(g,"disabled",true)}g.appendChild(s);m.appendChild(g)}}}function d(f,g){var h=true;if(!f){if(typeof g==="string"){h=g!==f}else{if(!g||((g.length===1)&&!g[0])){h=false}}}else{h=g!==f}return h}return{onGenerate:function(i,h,f){var g;if(this.getParam("appearance")==="full"){g=xtdom.createElement(f,"ul")}else{g=xtdom.createElement(f,"select")}xtdom.addClassName(g,"axel-choice");i.appendChild(g);return g},onInit:function(i,g,h){var f=this.getParam("values");if(this.getParam("hasClass")){xtdom.addClassName(this._handle,this.getParam("hasClass"))}if(this.getParam("multiple")==="yes"){$(this._handle).attr("multiple","multiple")}if(!h){c(this,this.getParam("values"),this.getParam("i18n"))}},onAwake:function(){var h=this,f=this.getDefaultData(),g=this.getParam("placeholder");if((this.getParam("appearance")!=="full")&&(g||(!f))){g=g||"";$(this._handle).prepend('<option class="axel-choice-placeholder" selected="selected" value="">'+(g||"")+"</option>");if(!f){this._param.values.splice(0,0,g);if(this._param.i18n!==this._param.values){this._param.i18n.splice(0,0,g)}if(g){$(this._handle).addClass("axel-choice-placeholder")}}}xtdom.addEventListener(this._handle,"change",function(i,j){if(!(j&&j.synthetic)){if(h.getParam("appearance")==="full"){var k=[];$("input",h.getHandle()).each(function(l,m){if(m.checked){k.push($(m).val())}});h.update(k)}else{h.update($(xtdom.getEventTarget(i)).val())}}},true);this._setData(f)},onLoad:function(l,k){var j,g,i,f,h;if(k.isEmpty(l)){this.clear(false)}else{f=this.getParam("xvalue");g=this.getDefaultData();if(f){j=[];i=k.getVectorFor(f,l);while(i!==-1){h=k.getDataFor(i);if(h){j.push(h)}i=k.getVectorFor(f,l)}this._setData(j.length>0?j:"")}else{h=k.getDataFor(l);if(typeof h!=="string"){h=""}j=(h||g).split(",");this._setData(j)}this.set(false);this.setModified(d(g,j))}},onSave:function(g){var f,j,h;if((!this.isOptional())||this.isSet()){if(this._data&&(this._data!==this.getParam("placeholder"))){f=this.getParam("xvalue");if(f){if(typeof this._data==="string"){g.openTag(f);g.write(this._data);g.closeTag(f)}else{for(h=0;h<this._data.length;h++){if(this._data[h]!==""){g.openTag(f);g.write(this._data[h]);g.closeTag(f)}}}}else{g.write(this._data.toString().replace(/^,/,""))}}}else{g.discardNodeIfEmpty()}},api:{_parseFromTemplate:function(h){var i,g;this._param={};xtiger.util.decodeParameters(h.getAttribute("param"),this._param);g=xtdom.extractDefaultContentXT(h);i=h.getAttribute("option");this._option=i?i.toLowerCase():null;var f=h.getAttribute("values"),l=h.getAttribute("i18n"),k=f?e(f):["undefined"],j=l?e(l):undefined;this._param.values=k;this._param.i18n=j||k;this._content=g||""},isFocusable:function(){return true},focus:function(){}},methods:{_setData:function(g,h){var f;if(this.getParam("appearance")!=="full"){if(!g&&(this.getParam("placeholder"))){$(this.getHandle()).addClass("axel-choice-placeholder")}else{$(this.getHandle()).removeClass("axel-choice-placeholder")}}this._data=g||"";if(!h){if(this.getParam("appearance")==="full"){f=typeof this._data==="string"?[this._data]:this._data;$("input",this.getHandle()).each(function(j,k){if($.inArray($(k).val(),f)>-1){k.checked=true;xtdom.removeClassName(k.parentNode,"axel-choice-unset")}else{k.checked=false;xtdom.addClassName(k.parentNode,"axel-choice-unset")}})}else{$(this.getHandle()).val(g)}}},dump:function(){return this._data},update:function(f){var g=d(this.getDefaultData(),f);this.setModified(g);this._setData(f,true);this.set(g)},clear:function(f){this._setData(this.getDefaultData());if(this.isOptional()){this.unset(f)}}}}}());a.plugin.register("choice",{filterable:true,optional:true},{choice:"value"},b);a.filter.applyTo({event:["choice"]})}($axel));(function(a){var b=(function(){function c(i){var h,g=[];for(h in i){if(i[h]){g.push(h+":"+i[h])}}h=g.join(";");return h?' style="'+h+'"':""}function e(j,l){var n,k,g="",m=j.getParam("choice2_width1"),i=c({width:m}),h=c({left:m,width:j.getParam("choice2_width2")});for(n in l){m="";for(k in l[n]){if(k!=="_label"){m+='<li class="choice2-label" data-code="'+k+'">'+l[n][k]+"</li>"}}g+='<li class="choice2-option"><div class="choice2-item"'+i+">"+n+" "+l[n]._label+'</div><ul class="choice2-popup2 choice2-drop-container"'+h+">"+m+"</ul></li>"}g='<ul class="choice2-popup1 choice2-drop-container"'+i+">"+g.replace(/&/g,"&amp;")+"</ul>";$(j.getHandle()).append(g)}function f(g){if(0===g.find("li.choice2-label:not(.selected)").size()){g.addClass("selected")}else{g.removeClass("selected")}}function d(g,h){var i=true;if(!g){if(typeof h==="string"){i=h!==g}else{if(!h||((h.length===1)&&!h[0])){i=false}}}else{i=h!==g}return i}return{onGenerate:function(j,i,g){var h,k={width:this.getParam("choice2_width0")};h=xtdom.createElement(g,"div");xtdom.addClassName(h,"axel-choice2");$(h).html('<div class="select2-container-multi"'+c(k)+'><ul class="select2-choices"></ul></div>');j.appendChild(h);return h},onInit:function(j,h,i){var g=this.getParam("values");if(this.getParam("hasClass")){xtdom.addClassName(this._handle,this.getParam("hasClass"))}if(!i){e(this,this.getParam("values"))}},onAwake:function(){var i=this,g=this.getDefaultData(),h=this.getParam("placeholder");if((this.getParam("appearance")!=="full")&&(h||(!g))){h=h||""}this._setData(g);$(this._handle).children("div.select2-container-multi").click($.proxy(this,"_handleClickOnChoices"));$(this._handle).find("li.choice2-label").click($.proxy(this,"_handleClickOnLabel"));$(this._handle).find("div.choice2-item").click($.proxy(this,"_handleClickOnItem"))},onLoad:function(m,l){var k,h,j,g,i;if(l.isEmpty(m)){this.clear(false)}else{g=this.getParam("xvalue");h=this.getDefaultData();if(g){k=[];j=l.getVectorFor(g,m);while(j!==-1){i=l.getDataFor(j);if(i){k.push(i)}j=l.getVectorFor(g,m)}this._setData(k.length>0?k:"")}else{i=l.getDataFor(m);if(typeof i!=="string"){i=""}k=(i||h).split(",");this._setData(k)}this.set(false);this.setModified(d(h,k))}},onSave:function(h){var g,k,j;if((!this.isOptional())||this.isSet()){if(this._data&&(this._data!==this.getParam("placeholder"))){g=this.getParam("xvalue");if(g){if(typeof this._data==="string"){h.openTag(g);h.write(this._data);h.closeTag(g)}else{for(j=0;j<this._data.length;j++){if(this._data[j]!==""){h.openTag(g);h.write(this._data[j]);h.closeTag(g)}}}}else{h.write(this._data.toString().replace(/^,/,""))}}}else{h.discardNodeIfEmpty()}},api:{_parseFromTemplate:function(i){var j,h;this._param={};xtiger.util.decodeParameters(i.getAttribute("param"),this._param);h=xtdom.extractDefaultContentXT(i);j=i.getAttribute("option");this._option=j?j.toLowerCase():null;var g=i.getAttribute("values"),k=JSON.parse(g);this._param.values=k;this._content=h||""},isFocusable:function(){return true},focus:function(){}},methods:{_handleClickOnChoices:function(k){var i=$(k.target),j=$(k.target).closest(".axel-choice2"),o,m,g,l;if(i.hasClass("select2-choices")||i.hasClass("select2-label")){m=i.hasClass("select2-label")?i.closest(".select2-choices").offset():i.offset();g=i.hasClass("select2-label")?i.closest(".select2-choices").height():i.height();o=j.children("ul.choice2-popup1");if(o.hasClass("show")){$("div.select2-container-multi ul",this._handle).css("minHeight","")}o.toggleClass("show").offset({top:m.top+g+1,left:m.left})}else{if(i.hasClass("select2-search-choice-close")){i=$(k.target).closest("li[data-code]").first();l=i.attr("data-code");o=j.find('ul.choice2-popup1 li.choice2-label[data-code="'+l+'"]').removeClass("selected");this.removeFromSelection(l,o);i.remove();k.stopPropagation()}}},_handleClickOnItem:function(i){var k=$(i.target),h=k.parent().find("li.choice2-label"),g="yes"===this.getParam("multiple"),j=this;if(g||(1===h.size())){if(k.parent().hasClass("selected")){h.each(function(l,m){var o=$(m);j.removeFromSelection(o.attr("data-code"),false);o.removeClass("selected")})}else{if(!g){this.setSelection([])}h.each(function(l,m){var o=$(m);j.addToSelection(o.attr("data-code"),o.text());o.addClass("selected")})}k.parent().toggleClass("selected")}},_handleClickOnLabel:function(g){var h=$(g.target);if(("yes"!==this.getParam("multiple"))&&!h.hasClass("selected")){this.setSelection([])}h.toggleClass("selected");if(h.hasClass("selected")){this.addToSelection(h.attr("data-code"),h.text());f(h.closest(".choice2-option"))}else{this.removeFromSelection(h.attr("data-code"),h)}},setSelection:function(g){var k="",l=$("li.choice2-label",this._handle),j,h;l.filter(".selected").removeClass("selected");for(j=0;j<g.length;j++){if(g[j].length>0){h=l.filter('[data-code="'+g[j]+'"]').first().addClass("selected").text();k+='<li class="select2-search-choice" data-code="'+g[j]+'"><div class="select2-label">'+h.replace(/&/g,"&amp;")+'</div><a class="select2-search-choice-close" tabindex="-1" onclick="return false;" href="#"></a></li>'}}$("div.select2-container-multi > ul",this._handle).html(k);$("li.choice2-option",this._handle).each(function(m,n){f($(n))})},addToSelection:function(i,g){var h=$("div.select2-container-multi > ul",this._handle);if((h.find('li.select2-search-choice[data-code="'+i+'"]')).size()===0){h.append('<li class="select2-search-choice" data-code="'+i+'"><div class="select2-label">'+g.replace(/&/g,"&amp;")+'</div><a class="select2-search-choice-close" tabindex="-1" onclick="return false;" href="#"></a></li>');if("true"===this.getParam("choice2_closeOnSelect")){$("ul.choice2-popup1",this._handle).removeClass("show")}this._setData($("li.select2-search-choice",this._handle).map(function(j,k){return $(k).attr("data-code")}).get(),true)}},removeFromSelection:function(g,h){var i=$("div.select2-container-multi ul",this._handle);if($(this._handle).children("ul.choice2-popup1").hasClass("show")){i.css("minHeight",i.height()+"px")}$('div.select2-container-multi li[data-code="'+g+'"]',this._handle).remove();this._setData($("li.select2-search-choice",this._handle).map(function(j,k){return $(k).attr("data-code")}).get(),true);if(h){h.closest(".choice2-option").removeClass("selected")}},_setData:function(h,i){var g;this._data=h||"";if(!i){g=typeof this._data==="string"?[this._data]:this._data;this.setSelection(g)}},dump:function(){return this._data},update:function(g){var h=d(this.getDefaultData(),g);this.setModified(h);this._setData(g,true);this.set(h)},clear:function(g){this._setData(this.getDefaultData());if(this.isOptional()){this.unset(g)}}}}}());a.plugin.register("choice2",{filterable:true,optional:true},{},b);a.filter.applyTo({event:["choice2"]})}($axel));(function(k){var l={};var a={};var h=function h(n,o){if(!l[n]){l[n]={}}l[n][o]=true};var b=function b(n,o){if(l[n]&&l[n][o]){delete l[n][o];return true}return false};var j=function(n){var o=n.getParam("date_format");return xtiger.util.date.convertDate(n,$.datepicker.formatDate($.datepicker[o]||o,new Date()),"date_format","date_region")};var d=function(p,o){var q=parseInt(o),n=((q===0)||(isNaN(q)))?1:q;if(a[p]===undefined){a[p]=0}else{a[p]+=1}return Math.floor(a[p]/n)};var c=function(n,o){var p;if(n.length>1){o.openTag("Block");while(p=n.shift()){o.openTag("Line");o.write(p);o.closeTag("Line")}o.closeTag("Block")}else{if(1===n.length){o.openTag("Text");o.write(n.pop());o.closeTag("Text")}}};var m={subscribe:function(n){var p=this;var o=function(q){if(!p.isEditing()){p.startEditing(q)}xtdom.stopPropagation(q);xtdom.preventDefault(q)};if(this.isEditable){xtdom.addEventListener(n,"focus",o,true);xtdom.addEventListener(n,"mouseup",function(q){xtdom.stopPropagation(q);xtdom.preventDefault(q)},true)}},isFocusable:function(){return(this.isEditable&&((!this._editor.isOptional())||this._editor.isSet()))},isEditing:function(){return this._isEditing},doKeyDown:function(n){},doKeyUp:function(n){},focus:function(){this._editor.getHandle().focus();this.startEditing()},unfocus:function(){this.stopEditing()},cancelEditing:function(){this._editor.getHandle().value=this._legacy;this.stopEditing(true,false)},clear:function(){this._editor.getHandle().value=this.defaultData},update:function(n){if(n===this._legacy){return}if(n.search(/\S/)===-1||(n===this._defaultData)){this._editor.clear(true)}else{this._editor.setModified(n!==this.defaultData);this._editor.set(true)}}};var g=function(s,n,o){var r=s.getHandle(),q="number"!==n?n:"text",p;this._editor=s;this.isEditable=!s.getParam("noedit");this.defaultData=o||"";xtdom.setAttribute(r,"type",q);if(p=s.getParam("size")){xtdom.setAttribute(r,"size",p)}r.value=this.defaultData};g.prototype={awake:function(){var n=this._editor.getHandle();var o=this;this.subscribe(n);if(this.isEditable){xtdom.addEventListener(n,"blur",function(p){if(o.isEditing()){o.stopEditing(false,true)}},true)}},load:function(u,s){var p,t,q;if(u!==-1){q=this._editor.getParam("multilines");if((q==="normal")||(q==="enhanced")){var r=u[0].firstChild,o,n="";while(r){if(r.nodeType===xtdom.ELEMENT_NODE&&r.firstChild){if("Text"===r.nodeName){n=n+r.firstChild.nodeValue+"\n\n"}else{if("Block"===r.nodeName){o=r.firstChild;while(o){if(o.nodeType===xtdom.ELEMENT_NODE&&o.firstChild){n=n+o.firstChild.nodeValue+"\n"}o=o.nextSibling}n=n+"\n"}}}r=r.nextSibling}p=n}else{p=s.getDataFor(u)}t=this._editor.getDefaultData();this._editor.getHandle().value=p||t||"";this._editor.setModified(p!==t);this._editor.set(false)}else{this._editor.clear(false)}},save:function(o){var s=$.trim(this._editor.getHandle().value),r,p;var q=function(u,t){if(t.length>0){o.openTag("Text");o.write(t);o.closeTag("Text")}};var n=function(v,u){var t=v.charCodeAt(1);if((t===10)||(t===13)){c(r,o);r=[]}if(u.length>0){r.push(u)}};if(s){multi=this._editor.getParam("multilines");if(multi){p=new RegExp("[\n\r]{0,}(.*)","g");if("normal"===multi){s.replace(p,q)}else{r=[];s.replace(p,n);c(r,o)}}else{if("number"===this._editor.getParam("type")){o.write(s.replace(",","."))}else{o.write(s)}}}},startEditing:function(o){var n,p=xtiger.session(this._editor.getDocument()).load("keyboard");if(!this._isEditing){n=this._editor.getHandle();this._legacy=n.value;this._isEditing=true;this.kbdHandlers=p.register(this,n);p.grab(this,this._editor);if(this._editor.getParam("multilines")){p.enableRC(true)}if(!this._editor.isModified()){xtdom.focusAndSelect(n)}}},stopEditing:function(n,r){var o,q,p;if(this._isEditing){o=this._editor.getHandle();q=xtiger.session(this._editor.getDocument()).load("keyboard");this._isEditing=false;q.unregister(this,this.kbdHandlers,o);q.release(this,this._editor);if("normal"===this._editor.getParam("multilines")){q.disableRC()}if(!n){p=this._editor.getParam("multilines");if(p==="normal"){o.value=$.trim(o.value).replace(/((\r\n|\n|\r)+)/gm,"$2$2").replace(/(\r\n|\n|\r)\s+(\r\n|\n|\r)/gm,"$1$2")}else{if(p==="enhanced"){o.value=$.trim(o.value).replace(/((\r\n|\n|\r){2,})/gm,"$2$2").replace(/(\r\n|\n|\r)\s+(\r\n|\n|\r)/gm,"$1$2")}}this._editor.update(o.value)}if((!r)&&(o.blur)){o.blur()}}}};var i=function(p,n,o){xtdom.setAttribute(p.getHandle(),"type","text");this._editor=p;this.isEditable=!p.getParam("noedit");this.defaultData=o||"";this.dpDone=false};i.prototype={lazyInit:function(o){var n,p=this;if($.datepicker){$(o).on("keydown",function(q){if(q.keyCode===$.ui.keyCode.ESCAPE){p.onEscape()}xtdom.stopPropagation(q)});this.jhandle=$(o).datepicker({onClose:function(){p.onClose()}})}else{alert('datepicker jQuery plugin needed for "date" input field !')}this.dpDone=true},awake:function(){var n=this._editor.getHandle();this.subscribe(n);if(this.defaultData==="today"){n.value=this.defaultData=$.datepicker?j(this._editor):new Date()}else{n.value=xtiger.util.date.convertDate(this._editor,this.defaultData,"date_format","date_region")}this.model=n.value;if(!this._editor.getParam("size")){xtdom.setAttribute(n,"size",8)}},onEscape:function(n){this.escape=true},onClose:function(){this.stopEditing(this.escape);this.escape=false},startEditing:function(q){var o,n,r,p;xtiger.util.date.setRegion(this._editor.getParam("date_region"));if(!this.dpDone){p=this._editor.getHandle();this.lazyInit(p);if(this.jhandle){o=this._editor.getParam("minDate");n=this._editor.getParam("maxDate");r=this._editor.getParam("beforeShow");if(o){o=(o==="today")?j(this._editor):xtiger.util.date.convertDate(this._editor,o,"date_format","date_region");this.jhandle.datepicker("option","minDate",o)}if(n){n=(n==="today")?j(this._editor):xtiger.util.date.convertDate(this._editor,n,"date_format","date_region");this.jhandle.datepicker("option","maxDate",n)}if(r){this.jhandle.datepicker("option","beforeShow",r)}$(p).datepicker("show")}}},stopEditing:function(n){var o=this._editor.getHandle();val=o.value;if(val.search(/\S/)===-1){val=""}if(val&&((val.length!==10)||n)){o.value=this.model}else{this._editor.update(val);this.model=o.value}},load:function(r,p){var o,q,n=this._editor.getHandle();if(r!==-1){o=p.getDataFor(r);o=o?($.datepicker?xtiger.util.date.convertDate(this._editor,o,"date_format","date_region"):o):null;q=this.defaultData;n.value=o||q||"";this._editor.setModified(o!==q);this._editor.set(false)}else{this.clear(false)}this.model=n.value},save:function(n){var o=this._editor.getHandle().value;if(o){o=$.datepicker?xtiger.util.date.convertDate(this._editor,o,"date_region","date_format"):o;n.write(o)}}};var f=function(s,n,q){var r=s.getHandle(),p=s.getParam("name"),o=s.getParam("cardinality");this._editor=s;this._type=n;if(p||(n==="radio")){if(o){q=d(p||"void",o).toString()}p=(p||"").concat(q||"");xtdom.setAttribute(r,"name",p)}if(s.getParam("checked")==="true"){xtdom.setAttribute(r,"checked",true)}else{if(s.getParam("noedit")==="true"){xtdom.addClassName(r,"axel-input-unset")}}};f.prototype={awake:function(){var n=this._editor.getHandle();var o=this;xtdom.addEventListener(n,"click",function(p){if(o._editor.getHandle().checked){o._editor.update(o._editor.getParam("value"))}else{o._editor.update("")}},true)},isFocusable:function(){return true},load:function(s,r){var q,o=this._editor.getHandle(),n=false,p=this._editor.getParam("value");if(-1!==s){q=r.getDataFor(s);n=(q===p);if(!n){name=this._editor.getParam("name");if(name){n=b(name,p);h(name,q)}}if(n){if(!o.checked){o.checked=true;this._editor.set(false);if(this._editor.getParam("noedit")==="true"){xtdom.removeClassName(o,"axel-input-unset")}}}else{this._editor.clear(false)}}else{name=this._editor.getParam("name");if(name){n=b(name,p)}if(n){if(!o.checked){o.checked=true;this._editor.set(false);if(this._editor.getParam("noedit")==="true"){xtdom.removeClassName(o,"axel-input-unset")}}}else{this._editor.clear(false)}}},save:function(n){if(this._editor.getHandle().checked){n.write(this._editor.getParam("value"))}else{n.discardNodeIfEmpty()}},update:function(n){},clear:function(){this._editor.getHandle().checked=false;if(this._editor.getParam("noedit")==="true"){xtdom.addClassName(this._editor.getHandle(),"axel-input-unset")}},focus:function(){this._editor.getHandle().focus()},unfocus:function(){}};var e={onGenerate:function(s,q,p){var r=q.getAttribute("param"),o=(!r||(r.indexOf("type=textarea")===-1))?"input":"textarea",n=xtdom.createElement(p,o);if(r){if(r.indexOf("type=radio")!==-1){xtdom.setAttribute(n,"type","radio")}else{if(r.indexOf("type=checkbox")!==-1){xtdom.setAttribute(n,"type","checkbox")}}}if(this.getParam("noedit")==="true"){n.disabled=true}s.appendChild(n);return n},onInit:function(r,n,p){var o,q;o=this.getParam("type");if((o==="text")||(o==="number")||(o==="password")||(o==="textarea")){this._delegate=new g(this,o,r)}else{if((o==="radio")||(o==="checkbox")){this._delegate=new f(this,o,p?p.getClockCount():undefined)}else{if(o==="date"){this._delegate=new i(this,o,r)}else{xtdom.addClassName(this._handle,"axel-generator-error");xtdom.setAttribute(this._handle,"readonly","1");xtdom.setAttribute(this._handle,"value",'ERROR: type "'+o+'" not recognized by plugin "input"');alert('Form generation failed : fatal error in "input" plugin declaration')}}}if(this.getParam("hasClass")){xtdom.addClassName(this._handle,this.getParam("hasClass"))}},onAwake:function(){this._delegate.awake()},onLoad:function(o,n){this._delegate.load(o,n)},onSave:function(n){if(($(this.getHandle()).attr("disabled")==="disabled")||(this.isOptional()&&!this.isSet())){n.discardNodeIfEmpty()}else{this._delegate.save(n)}},api:{isFocusable:function(){return this._delegate.isFocusable()},focus:function(){if(this._delegate.focus){this._delegate.focus()}},unfocus:function(){if(this._delegate.focus){this._delegate.unfocus()}}},methods:{update:function(n){this._delegate.update(n)},clear:function(n){this._delegate.clear();this.setModified(false);if(this.isOptional()&&this.isSet()){this.unset(n)}},set:function(n){if(n){if(!this.getParam("noedit")){xtiger.editor.Repeat.autoSelectRepeatIter(this.getHandle())}xtdom.removeClassName(this._handle,"axel-repeat-unset")}if(!this._isOptionSet){this._isOptionSet=true;if(this._isOptional){this._handle.disabled=false;this._optCheckBox.checked=true}}},unset:function(n){if(this._isOptionSet){this._isOptionSet=false;if(this._isOptional){this._handle.disabled=true;this._optCheckBox.checked=false}}}}};k.extend(g.prototype,m);k.extend(i.prototype,m);k.plugin.register("input",{filterable:true,optional:true},{type:"text",date_region:"fr",date_format:"ISO_8601"},e)}($axel));(function(a){var b={onGenerate:function(f,e,c){var d=xtdom.createElement(c,"div");xtdom.addClassName(d,"af-html");f.appendChild(d);return d},onInit:function(e,c,d){if(this.getParam("hasClass")){xtdom.addClassName(this._handle,this.getParam("hasClass"))}},onAwake:function(){},onLoad:function(f,e){var c,d;if(e.isEmpty(f)){$(this.getHandle()).html("")}else{d=$(this.getHandle());d.html("");for(c=1;c<f.length;c++){d.append(f[c])}}},onSave:function(c){c.write("HTML BLOB")},api:{},methods:{}};a.plugin.register("html",{filterable:false,optional:false},{key:"value"},b)}($axel));(function(h){var f={dropdownAutoWidth:"bool",minimumResultsForSearch:"int",closeOnSelect:"bool",width:"str",maximumSelectionSize:"int",minimumInputLength:"int"};function b(l){var k,m,p,j="",o="ÀÁÂÃÄÅÒÓÔÕÕÖØÈÉÊËÇÐÌÍÎÏÙÚÛÜÑŠŸŽ",n="AAAAAAOOOOOOOEEEECDIIIIUUUUNSYZ";for(k=0;k<l.length;k++){m=l.charAt(k).toUpperCase();p=o.indexOf(m);j+=(p>=0)?n.charAt(p):m}return j}function e(o,n,l,j,m){var k=n.length;l.push(j(o.substring(0,m)));l.push("<span class='select2-match'>");l.push(j(o.substring(m,m+k)));l.push("</span>");l.push(j(o.substring(m+k,o.length)))}function d(m,j){var n,l,k;if($.isArray(m)&&m[0]){n=m[0].text||""}else{n=(m&&m.text)?m.text:""}l=n.indexOf("::");k=(l!==-1)?n.substr(0,l):n;return k}function g(j,l,r,q,m){var t=(j&&j.text)?j.text:"",o=t.indexOf("::"),k=m||' - <span class="select2-complement">',n="</span>",s=b(r.term),p,u;if(t){u=[];if(o!==-1){if(r.term.length>0){p=b(t).indexOf(s);if(p<o){e(t.substr(0,o),s,u,q,p);u.push(k+q(t.substr(o+2))+n)}else{if(p>o+1){u.push(t.substr(0,o));u.push(k);e(t.substr(o+2),s,u,q,p-o-2);u.push(n)}else{return q(t.substr(0,o))+k+q(t.substr(o+2))+n}}}else{return q(t.substr(0,o))+k+q(t.substr(o+2))+n}}else{if(r.term.length>0){p=b(t).indexOf(s);if(p>=0){e(t,s,u,q,p)}else{return t}}else{return t}}return u.join("")}}function c(k,m,l){var j;if(l){j=l.data("key");if(!j){j=b(m);l.data("key",j)}}else{j=b(m)}return j.indexOf(b(k))>=0}function a(j,k){var l=k-j.length;return xtiger.util.getLocaleString("hintMinInputSize",{n:l})}var i={onGenerate:function(l,k,j){var m;if(this.getParam("select2_tags")==="yes"){m=xtdom.createElement(j,"input")}else{m=this.__select2__onGenerate(l,k,j)}l.appendChild(m);$(m).wrap('<span class="axel-guard"/>');return m},onAwake:function(){var p=this,o=this.getDefaultData(),m=this.getParam("placeholder"),q=this.getParam("select2_complement"),t=q?' - <span class="'+q+'">':undefined,r=q?function(k,w,u,v){return g(k,w,u,v,t)}:g,l={myDoc:this.getDocument(),formatResult:r,formatSelection:d,matcher:c,formatInputTooShort:a},n,s,j;for(n in f){s=this.getParam("select2_"+n);if(s){if(f[n]==="bool"){j=s==="true"?true:false}else{if(f[n]==="int"){j=parseInt(s,10)}else{j=s}}l[n]=j}}if(this.getParam("select2_tags")==="yes"){l.multiple=false;l.tags=this.getParam("i18n");delete l.minimumResultsForSearch}else{if(m||(!o)){m=m||"";if(this.getParam("multiple")!=="yes"){$(this._handle).prepend("<option></option>")}if(!o){this._param.values.splice(0,0,m);if(this._param.i18n!==this._param.values){this._param.i18n.splice(0,0,m)}}l.allowClear=true;l.placeholder=m}if(this.getParam("multiple")!=="yes"){if(this.getParam("typeahead")!=="yes"){l.minimumResultsForSearch=-1}}}this._setData(o);$(this._handle).select2(l).change(function(k,u){if(!(u&&u.synthetic)){p.update($(this).val())}});$(this._handle).prev(".select2-container").get(0).xttNoShallowClone=true},onLoad:function(k,j){this.__select2__onLoad(k,j);$(this._handle).trigger("change",{synthetic:true})},api:{update:function(j){var k=this;this.__select2__update(j);setTimeout(function(){$(k._handle).select2("focus")},50)},focus:function(){$(this._handle).select2("focus")}},methods:{_setData:function(l,m){var j=l,k;if(this.getParam("select2_tags")){k=l.indexOf("::");if(k!==-1){j=l.substr(0,k)}}this.__select2___setData(j,m)}}};h.filter.register("select2",{chain:["update","onGenerate","onLoad","_setData"]},{select2_dropdownAutoWidth:"false",select2_minimumResultsForSearch:"7",select2_closeOnSelect:"false",select2_width:"element",select2_maximumSelectionSize:"-1",select2_minimumInputLength:undefined},i);h.filter.applyTo({select2:"choice"})}($axel));(function(a){var d={onLoad:function c(l,k){var i,j,g,f,e=this.getParam("xvalue");if(k.isEmpty(l)||!e){this.__list__onLoad(l,k)}else{j=[];g=k.getVectorFor(e,l);while(g!==-1){f=k.getDataFor(g);if(f){j.push(f)}g=k.getVectorFor(e,l)}j=j.join(", ");i=this.getHandle();fallback=this.getDefaultData()||"";this.getHandle().value=j||fallback||"";this.setModified(j!==fallback);this.set(false)}},onSave:function b(f){var e,j,g,h=$.trim(this.getHandle().value);if((!this.isOptional())||this.isSet()){if(h){e=this.getParam("xvalue");if(e){j=h.split(/\s*,\s*/);for(g=0;g<j.length;g++){if(j[g]!==""){f.openTag(e);f.write(j[g]);f.closeTag(e)}}}else{this.__list__onSave(f)}}}else{f.discardNodeIfEmpty()}},methods:{update:function(e){var f=this.getHandle().value.split(/\s*,\s*/).join(", ");if("true"===this.getParam("list_uppercase")){f=f.toUpperCase()}this.getHandle().value=f;fallback=this.getDefaultData()||"";this.setModified(f!==fallback)}}};a.filter.register("list",{chain:["onLoad","onSave"]},null,d);a.filter.applyTo({list:["input"]})}($axel));(function(a){var b={onInstall:function(c){this.avoidstr="data-avoid-"+this.getVariable();this.editor=a(c);c.bind("axel-update",$.proxy(this.updateConditionals,this));this.updateConditionals();$(document).bind("axel-content-ready",$.proxy(this,"updateConditionals"))},methods:{updateConditionals:function(f,e){var d,h;var g=this.editor.text();var c=$("body ["+this.avoidstr+"]",this.getDocument());d=(g!="")?c.not("["+this.avoidstr+'*="'+g+'"]'):c.not("["+this.avoidstr+'=""]');h=(g!="")?c.filter("["+this.avoidstr+'*="'+g+'"]'):c.filter("["+this.avoidstr+'=""]');d.find("input").removeAttr("disabled");d.css("color","inherit");h.find("input").attr("disabled","disabled");h.css("color","lightgray")}}};a.binding.register("condition",null,null,b)}($axel));(function(a){function c(f,d,h){try{return d?xtiger.util.date.convertDate(f,d,"date_format","date_region"):h}catch(g){return h}}var b={onInstall:function(g){var e=this.getVariable(),f=$("[data-min-date="+e+"]",g.get(0)),d=$("[data-max-date="+e+"]",g.get(0));this.min=a(f.get(0),true);this.max=a(d.get(0),true);this.min.configure("beforeShow",$.proxy(this.beforeShowMinDate,this));this.max.configure("beforeShow",$.proxy(this.beforeShowMaxDate,this))},methods:{beforeShowMinDate:function(d,e){return{maxDate:c(this.max.get(0),this.max.text(),null)}},beforeShowMaxDate:function(d,e){return{minDate:c(this.min.get(0),this.min.text(),null)}}}};a.binding.register("interval",null,null,b)}($axel));(function(a){var b={onInstall:function(c){var d=c.attr("data-pattern");this.re=new RegExp(this.getParam("regexp")||"");this.editor=a(c);c.bind("axel-update",$.proxy(this.checkRegexp,this));if(d){c.find("input").attr("pattern",d)}a.binding.setValidation(this.editor.get(0),$.proxy(this.checkRegexp,this))},methods:{checkRegexp:function(){var c=this.re.test(this.editor.text());return this.toggleError(c,this.editor.get(0).getHandle(true))}}};a.binding.register("regexp",{error:true},{regexp:a.binding.REQUIRED},b)}($axel));(function(b){var a={onInstall:function(c){this.editors=b(c);this.handle=c.get(0);if(this.handle.xttPrimitiveEditor){xtiger.cross.log("error",'Failed attempt to attach a "required" binding directly onto a primitive editor')}else{this.handle.xttPrimitiveEditor=this}},methods:{isModified:function(){var c=(this.editors.text()!=="");return c},isFocusable:function(){var c=this.editors.get(1);return(c&&(c!==this))?c.isFocusable():false},focus:function(){var c=this.editors.get(0);if(c){this.editors.get(0).focus()}},unfocus:function(){},can:function(c){return false},getHandle:function(){return this.handle},onInit:function(e,c,d){},onAwake:function(){},load:function(d,c){},save:function(c){}}};b.binding.register("required",{error:true},{required:"true"},a)}($axel));(function(a){var b={onInstall:function(c){this.host=c;this.editors=a(c);$('[data-select="'+this.getVariable()+'"]',this.getDocument()).bind("click",$.proxy(this,"execute"))},methods:{execute:function(){this.editors.apply(function(c){if(!c.disabled){c.checked=true}},true);$(this.host).triggerHandler("axel-select-all",[this])}}};a.binding.register("select",null,null,b)}($axel));(function(){function a(c,d,e){var b=$(d);this.doc=e;this.key=c;this.spec=b;if(b.attr("data-command")!=="transform"){this.transform();this.implicit=true}else{this.implicit=false}this.defaultTpl=this.spec.attr("data-template");this.defaultData=this.spec.attr("data-src")||"";this.ready=false}a.prototype={getDefaultTemplate:function(){return this.defaultTpl},getDefaultSrc:function(){return this.defaultData},attr:function(b){if(arguments.length>1){return this.spec.attr(b,arguments[1])}else{return this.spec.attr(b)}},transform:function(c,b){var e,h,d,f=c||this.spec.attr("data-template"),g=b||this.spec.attr("data-src");if((f===this.spec.attr("data-template"))&&this.ready){this.reset()}else{if(f){if(f!=="#"){e=f.substring(f.lastIndexOf("/")+1);if(e.indexOf("?")!==-1){e=e.substring(0,e.indexOf("?"))}}d={bundlesPath:$axel.command.defaults.bundlesPath,enableTabGroupNavigation:true};h=(f==="#")?$axel(this.spec).transform(d):$axel(this.spec).transform($axel.resolveUrl(f,this.spec.get(0)),d);if(g){h.load($axel.resolveUrl(g,this.spec.get(0)));this.spec.attr("data-src",g)}if(this.spec.attr("data-cancel")){$(window).bind("unload",$.proxy(this,"reportCancel"))}if(h.transformed()){if(!this.implicit){$axel.binding.install(this.doc,this.spec.get(0),this.spec.get(0));$axel.command.install(this.doc,this.spec.get(0).firstChild,this.spec.get(0).lastChild)}this.spec.attr("data-template",f);this.spec.addClass("edition").addClass(e);this.ready=true}else{this.ready=false}}else{$axel.error('Missing data-template attribute to generate the editor "'+this.key+'"')}}},reset:function(c){var b;if(c&&this.defaultTpl&&(this.defaultTpl!==this.spec.attr("data-template"))){this.attr("data-src",this.defaultData);this.transform($axel.resolveUrl(this.defaultTpl,this.spec.get(0)))}else{b=this.spec.attr("data-src");if(b){$axel(this.spec).load($axel.resolveUrl(b,this.spec.get(0)))}else{$axel(this.spec).load("<Reset/>")}$('*[class*="af-invalid"]',this.spec.get(0)).removeClass("af-invalid");$('*[class*="af-required"]',this.spec.get(0)).removeClass("af-required")}},reload:function(){var b=this.spec.attr("data-src");if(b){$axel(this.spec).load($axel.resolveUrl(b,this.spec.get(0)))}},trigger:function(c,d,b){this.spec.triggerHandler(c,[this,d,b])},serializeData:function(){return $axel(this.spec).xml()},reportCancel:function(b){if(!this.hasBeenSaved){$.ajax({url:this.spec.attr("data-cancel"),data:{transaction:this.spec.attr("data-transaction")},type:"GET",async:false})}}};$axel.command.register("transform",a,{check:false})}());(function(){function a(b,c){this.key=b;$(c).bind("click",$.proxy(this,"execute"))}a.prototype={execute:function(d){var b,c=$axel.command.getEditor(this.key);if(c){c.reset();b=c.attr("data-validation-output");if(b){$("#"+b).removeClass("af-validation-failed")}}}};$axel.command.register("reset",a,{check:true})}());(function(){function a(b,c,d){this.doc=d||document;this.spec=$(c);this.key=b;this.spec.bind("click",$.proxy(this,"execute"))}a.prototype=(function(){function f(i,k){var j;if(/all|swap|append|prepend/.test(i)){j=$axel.oppidum.unmarshalPayload(k);fnode=$("#"+this.spec.attr("data-replace-target"));if(fnode.length>0){if(i.indexOf("all")!==-1){fnode.replaceWith(j)}else{if(i.indexOf("swap")!==-1){this.swap=$(j);fnode.after(this.swap);fnode.hide();this.fragment=fnode;$('button[data-command="continue"]',this.swap).bind("click",$.proxy(c,this));$('button[data-command="reset"]',this.swap).bind("click",$.proxy(g,this))}else{if(i.indexOf("append")!==-1){fnode.append(j)}else{if(i.indexOf("prepend")!==-1){fnode.prepend(j)}}}}}else{xtiger.cross.log("error",'missing "data-replace-target" attribute to report "save" command success')}}}function c(){this.swap.remove();this.fragment.show()}function g(){var i=$axel.command.getEditor(this.key);if(i){i.reset();this.swap.remove();this.fragment.show()}else{$axel.error(xtiger.util.getLocaleString("editorNotFound"))}}function e(k,l,q,p){var o,i,m,n,j;if((q.status===202)&&p){n=confirm($("success > message",q.responseXML).text());if(p.url.indexOf("?")!==-1){m=p.url+"&_confirmed=1"}else{m=p.url+"?_confirmed=1"}if(n){$.ajax({url:m,type:p.method,data:p.payload,cache:false,timeout:50000,dataType:"xml",contentType:"application/xml; charset=UTF-8",success:$.proxy(e,this),error:$.proxy(d,this)});return}else{$axel.command.getEditor(this.key).trigger("axel-save-cancel",this,q)}}else{if((q.status===201)||(q.status===200)){j=$axel.oppidum.getCommand(q);if($axel.oppidum.filterRedirection(j)){$axel.oppidum.handleMessage(j);o=this.spec.attr("data-replace-type")||"all";f.call(this,o,q);$axel.command.getEditor(this.key).trigger("axel-save-done",this,q);if(o.indexOf("event")!==-1){m=this.spec.attr("data-event-target");if(m){m=$axel.command.getEditor(m);if(m){m.trigger("axel-save-done",this,q)}}}}}else{$axel.error(xtiger.util.getLocaleString("errServerResponse",{xhr:q}));$axel.command.getEditor(this.key).trigger("axel-save-error",this,q)}}h(this);if(j){$axel.oppidum.handleForward(j)}}function d(m,j,k){var l,i=this.spec.attr("data-save-flags");if((!i)||i.indexOf("silentErrors")===-1){l=$axel.oppidum.parseError(m,j,k);$axel.error(l)}else{this.spec.trigger("axel-network-error",{xhr:m,status:j,e:k})}$axel.command.getEditor(this.key).trigger("axel-save-error",this,m);h(this)}function b(j){var i=j.spec.attr("data-save-flags");if(i&&i.indexOf("disableOnSave")!=-1){j.spec.attr("disabled","disable")}j.spec.addClass("axel-save-running")}function h(j){var i=j.spec.attr("data-save-flags");if(i&&i.indexOf("disableOnSave")!=-1){j.spec.removeAttr("disabled")}j.spec.removeClass("axel-save-running")}return{execute:function(k){var j,t,m,n,p,o,q,s=this,i=true,r=$axel.command.getEditor(this.key),l=this.spec.attr("data-save-confirm");if(r){if(!l||confirm(l)){url=this.spec.attr("data-src")||r.attr("data-src")||".";if(url){if(r.attr("data-validation-output")||this.spec.attr("data-validation-output")){p=$axel(r.spec.get(0));i=$axel.binding.validate(p,r.attr("data-validation-output")||this.spec.attr("data-validation-output"),this.doc,r.attr("data-validation-label")||this.spec.attr("data-validation-label"))}if(i){n=r.serializeData();if(n){j=r.attr("data-method")||this.spec.attr("data-method")||"post";m=r.attr("data-transaction")||this.spec.attr("data-transaction");if(m){url=url+"?transaction="+m}url=$axel.resolveUrl(url,this.spec.get(0));b(this);$axel.command.getEditor(this.key).trigger("axel-save",this);q={url:url,payload:n,method:j};o=function(v,w,u){e.call(s,v,w,u,q)};$.ajax({url:url,type:j,data:n,dataType:"xml",cache:false,timeout:50000,contentType:"application/xml; charset=UTF-8",success:o,error:$.proxy(d,this)});r.hasBeenSaved=true}else{$axel.error(xtiger.util.getLocaleString("editorEmpty"))}}}else{$axel.error(xtiger.util.getLocaleString("noTargetURL"))}}}else{$axel.error(xtiger.util.getLocaleString("editorNotFound"))}}}}());$axel.command.register("save",a,{check:false})}());(function(){function a(c,d){var b=$(d);this.key=c;this.formid=b.attr("data-form");if(this.formid&&($("form#"+this.formid).length>0)){d.disabled=false;b.bind("click",$.proxy(this,"execute"))}else{d.disabled=true;$axel.error('Missing or invalid data-form attribute in submit command ("'+this.formid+'")')}}a.prototype={execute:function(){var c=$("#"+this.formid),e=$("#"+this.formid+' > input[name="data"]'),b=$axel.command.getEditor(this.key);if(b&&(c.length>0)&&(e.length>0)){e.val(b.serializeData());c.submit()}else{$axel.error("Missing editor or malformed form element to submit data")}}};$axel.command.register("submit",a,{check:true})}());(function(){function a(b,c){this.spec=$(c);this.key=b;this.spec.bind("click",$.proxy(this,"execute"))}a.prototype={execute:function(b){$axel.command.getEditor(this.key).trigger(this.spec.attr("data-trigger-event"),this)}};$axel.command.register("trigger",a,{check:false})}());(function(){function a(b,c){this.spec=$(c);this.key=b;this.spec.bind("click",$.proxy(this,"execute"));$("#"+b).bind("axel-cancel-edit",$.proxy(this,"dismiss"));$("#"+b).bind("axel-save-done",$.proxy(this,"saved"))}a.prototype={execute:function(e){var c,d,g,b=$axel.command.getEditor(this.key),f=this.spec.attr("data-edit-action");if(f){if(f==="update"){b.attr("data-src",this.spec.attr("data-src"))}else{if(f==="create"){b.attr("data-src","")}}}if(!this.done||!b.getDefaultTemplate()){d=this.spec.attr("data-with-template");b.transform(d?$axel.resolveUrl(d,this.spec.get(0)):undefined)}else{if(this.cleanOnShow){b.reset();this.cleanOnShow=false}}d=this.spec.attr("data-add-key");if(d){d="data-when-"+d;g=$("#"+this.spec.attr("data-title-scope")).find("["+d+"]");g.text(g.attr(d))}if($axel("#"+this.key).transformed()){this.done=true;c=this.spec.attr("data-target-modal");if(f==="create"){b.attr("data-src",this.spec.attr("data-src"))}if(c){$("#"+c).modal("show").one("hidden",$.proxy(this,"hidden"));this.spec.get(0).disabled=true}else{$("#"+this.spec.attr("data-target-ui")).show();this.spec.hide()}}},dismiss:function(c){var b;b=this.spec.attr("data-target-modal");if(b){$("#"+b).modal("hide")}else{$("#"+this.spec.attr("data-target-ui")).hide();this.spec.show()}},saved:function(b){this.dismiss();this.cleanOnShow=true},hidden:function(){this.spec.get(0).disabled=false}};$axel.command.register("add",a,{check:true})}());(function(a){a.addLocale("en",{errFormRequired:function(b){return"You must fill the following fields : "+b.fields},errFormInvalid:function(b){return"You must correct the following fields : "+b.fields},hintMinInputSize:function(b){return"Type at least "+b.n+" letter"+(b.n===1?"":"s")},errServerResponse:function(b){return"Unexpected response from server ("+b.xhr?b.xhr.status:"undefined). The action may have failed"},errServerTimeOut:"Action aborted: server is taking too much time to answer. You should reload the page to check if the action has been executed anyway",msgRedirect:"You are going to be redirected",editorEmpty:"The document contains no data",noTargetURL:"The command does not know where to send the data",editorNotFound:"There is no editor associated with this command"})}($axel));(function(a){a.addLocale("fr",{errFormRequired:function(b){return"Vous devez remplir les champs suivants : "+b.fields},errFormInvalid:function(b){return"Vous devez corriger les champs suivants : "+b.fields},hintMinInputSize:function(b){return"Entrez au moins "+b.n+" caractère"+(b.n===1?"":"s")},errServerResponse:function(b){return"Mauvaise réponse du serveur ("+b.xhr?b.xhr.status:"undefined). L'action a peut-être échoué"},errServerTimeOut:"Action annulée, délai de réponse dépassé. Rechargez la page pour vérifier si votre action a été prise en compte.",msgRedirect:"Vous allez être redirigé",editorEmpty:"Le document est vide",noTargetURL:"La commande ne sait pas où envoyer les données",editorNotFound:"Il n'y a pas d'éditeur associé avec cette commande"})}($axel));